cimport pysox

DEF SOX_SUCCESS = 0

def createsession():
    cdef int ret = 0
    with nogil:
        ret = pysox.create_session()
    return ret
    
def stopsession(session_id):
    cdef int session_id_c = session_id
    cdef int ret = 0
    with nogil:
        ret = pysox.stop_session(session_id_c)
    return ret

def trans(session_id, argv):
    argvv = "sox " + argv
    cdef char * argvv_c = argvv
    cdef int session_id_c = session_id
    cdef int ret = 0
    with nogil:
        ret = pysox.sox(session_id_c, argvv_c)
    return ret

def play(session_id, argv):
    argvv = "play " + argv
    cdef char * argvv_c = argvv
    cdef int session_id_c = session_id
    cdef int ret = 0
    with nogil:
        ret = pysox.sox(session_id_c, argvv_c)
    return ret

def rec(session_id, argv):
    argvv = "rec " + argv
    cdef char * argvv_c = argvv
    cdef int session_id_c = session_id
    cdef int ret = 0
    with nogil:
        ret = pysox.sox(session_id_c, argvv_c)
    return ret

def soxi(session_id, argv):
    argvv = "soxi " + argv
    cdef char * argvv_c = argvv
    cdef int session_id_c = session_id
    cdef int ret = 0
    with nogil:
        ret = pysox.sox(session_id_c, argvv_c)
    return ret

cdef class __CSoxInit:

    def __cinit__(self):
        cdef int result
        result = pysox.sox_init()
        if result != SOX_SUCCESS:
            raise ImportError("sox_init not successful")
        pysox.sessionmap_init()
        
    def __dealloc__(self):
        pysox.sessionmap_destroy()
        pysox.sox_quit()

__sox_initializer = __CSoxInit()
